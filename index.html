<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="generator" content="Aspose.Words for .NET 22.6.0" /><title></title><style type="text/css">body { font-family:Calibri; font-size:11pt }h1, h2, h3, h4, h5, h6, p { margin:0pt 0pt 8pt }li { margin-top:0pt; margin-bottom:8pt }h1 { margin-top:12pt; margin-bottom:3pt; page-break-after:avoid; font-family:Arial; font-size:16pt; font-weight:bold }h2 { margin-top:12pt; margin-bottom:3pt; page-break-after:avoid; font-family:Arial; font-size:14pt; font-weight:bold; font-style:italic }h3 { margin-top:12pt; margin-bottom:3pt; page-break-after:avoid; font-family:Arial; font-size:13pt; font-weight:bold }h4 { margin-top:12pt; margin-bottom:3pt; page-break-after:avoid; font-size:14pt; font-weight:bold }h5 { margin-top:12pt; margin-bottom:3pt; font-size:13pt; font-weight:bold; font-style:italic }h6 { margin-top:12pt; margin-bottom:3pt; font-size:11pt; font-weight:bold }.FencedCode { margin-bottom:8pt; font-family:Consolas; font-size:10pt; background-color:#e2e2e2 }.IndentedCode { margin-bottom:8pt; font-family:Consolas; font-size:10pt; background-color:#e2e2e2 }span.Hyperlink { text-decoration:underline; color:#0000ff }</style></head><body><div><h1><span style="font-weight:normal">Kotlin</span><span style="font-family:Calibri; font-weight:normal">协程初探</span></h1><h2><span style="font-weight:normal; font-style:normal">1.</span><span style="font-family:Calibri; font-weight:normal; font-style:normal">简介</span></h2><h3><span style="font-weight:normal">1.1</span><span style="font-family:Calibri; font-weight:normal">定义：</span></h3><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>协程是一种</span><span style="font-weight:bold">并发设计模式</span><span>，可以用于在 Android 平台上使用它来简化</span><span style="font-weight:bold">异步执行</span><span>的代码。</span></p><p><span>示例代码:</span></p><p class="FencedCode"><span>suspend fun fetchDocs() {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>val result = get("developer.android.com")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>show(result)</span><br /><span>}</span></p><p><span>之前的代码是这样的</span></p><p class="FencedCode"><span>fun fetchDocs() {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>get("developer.android.com") { result -&gt;</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>show(result)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span>}</span></p><h3><span style="font-weight:normal">1.2 </span><span style="font-family:Calibri; font-weight:normal">协程特性</span></h3><p><span>协程是一种异步任务的解决方案，主要有以下几个特性:</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span style="font-weight:bold">轻量</span></p><p><span>轻量是对比线程的，比如同时开启10万个协程</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;</span><span>repeat(100_000) {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>launch {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(5000L)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>print(".")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p><span>试试用假如开启10万个线程</span></p><p class="FencedCode"><span>//Exception in thread "main" java.lang.OutOfMemoryError: unable to create new native thread</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>repeat(100_000) {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>Thread {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>Thread.sleep(1000)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>print(".")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}.start()</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:ignore">&#xa0;</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span style="font-weight:bold">内存泄漏更少</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span style="font-weight:bold">内置(自动)取消支持</span><br /><span>取消操作会自动在运行中的整个协程层次结构内传播</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span style="font-weight:bold">jetpack集成</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:' '; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="-aw-import:spaces">&#xa0;</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><a href="https://developer.android.com/kotlin/ktx" style="text-decoration:none"><span class="Hyperlink">jetpackPack扩展</span></a><span>、</span><a href="https://developer.android.com/topic/libraries/architecture/coroutines" style="text-decoration:none"><span class="Hyperlink">协程作用域</span></a></p><h2><span style="font-weight:normal; font-style:normal">2. </span><span style="font-family:Calibri; font-weight:normal; font-style:normal">协程名词及概念</span></h2><h3><span style="font-weight:normal">2.1</span><span style="font-family:Calibri; font-weight:normal">协程作用域（</span><span style="font-weight:normal">CoroutineScope)</span></h3><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span style="font-weight:bold">CoroutineScope</span><span>(</span><a href="https://developer.android.com/kotlin/coroutines/coroutines-adv#coroutinescope" style="text-decoration:none"><span class="Hyperlink">Android官网</span></a><span>)会跟踪它使用 launch 或 async 创建的所有协程。</span></p><p><img src="https://github.com/jinbo007/Course/blob/master/kotlin/img/CoroutineCoext%E6%93%8D%E4%BD%9C%E4%BC%98%E5%85%88%E7%BA%A7.png?raw=true" width="288" height="288" alt="图片" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h4><span style="font-weight:normal">常见作用域</span></h4><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>GlobalScope(全局作用域)</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>runBlocking （顶级函数，内置作用域）</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>coroutineScope（独立作用域）</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>supervisorScope（监督作用域）</span></p><h3><span style="font-weight:normal">2.2 </span><span style="font-family:Calibri; font-weight:normal">协程上下文</span><span style="font-weight:normal">(CoroutineContext)</span></h3><p><span>==</span><span style="font-weight:bold">关键元素分析</span><span>==</span></p><h4><span style="font-weight:normal">2.2.1 Job(作业)</span></h4><p><span>Job 是协程的句柄，可以用于控制协程的生命周期。</span><a href="https://developer.android.com/kotlin/coroutines/coroutines-adv?hl=zh-cn#job" style="text-decoration:none"><span class="Hyperlink">Android官网-详细点击</span></a><br /><span>使用 launch 或 async 创建的每个协程都会返回一个 Job 实例，该实例是相应协程的唯一标识并管理其生命周期。您还可以将 Job 传递给 CoroutineScope 以进一步管理其生命周期，如以下示例所示</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;&#xa0; </span><span>val job = scope.launch {</span><br /><br /><span style="-aw-import:spaces">&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0; </span><span>job.cancel()//取消协程</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0; </span><span>job.join()//等待协程完成</span><br /><br /><span style="-aw-import:spaces">&#xa0;&#xa0; </span><span>val job2 = scope.async {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>"result"</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0; </span><span>}</span><br /><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>job2.cancel()//取消协程</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>job2.join()//等待完成</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>job2.await()//返回结果</span><br /><span style="-aw-import:ignore">&#xa0;</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>一个Job的生命周期</span><br /><img src="https://github.com/jinbo007/Course/blob/master/kotlin/img/Job生命周期图.png?raw=true" width="288" height="288" alt="Job生命周期" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /><span style="-aw-import:ignore">&#xa0;</span></p><h4><span style="font-weight:normal">2.2.2 CoroutineDispatcher(协程调度器)</span></h4><p><span>将工作分派到适当的线程（类似Rxjava 的 Schedulers.io())</span><br /><span>Koltin提供了三个调度程序:</span><a href="https://developer.android.com/kotlin/coroutines/coroutines-adv?hl=zh-cn#main-safety" style="text-decoration:none"><span class="Hyperlink">Android官网-详细点击</span></a></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>Dispatchers.Main</span></p><h6><span style="font-weight:normal">使用此调度程序可在 Android 主线程上运行协程。此调度程序只能用于与界面交互和执行快速工作。示例包括调用 suspend 函数，运行 Android 界面框架操作，以及更新 LiveData 对象。</span></h6><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>Dispatchers.IO IO</span></p><h6><span style="font-weight:normal">此调度程序经过了专门优化，适合在主线程之外执行磁盘或网络 I/O。示例包括使用 Room 组件、从文件中读取数据或向文件中写入数据，以及运行任何网络操作。</span></h6><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>Dispatchers.Default ,</span></p><h6><span style="font-weight:normal">此调度程序经过了专门优化，适合在主线程之外执行占用大量 CPU 资源的工作。用例示例包括对列表排序和解析 JSON</span></h6><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>切换线程示例代码</span></p><p class="FencedCode"><span>suspend fun fetchDocs() {</span><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>// Dispatchers.Main</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>val result = get("developer.android.com")</span><span style="-aw-import:spaces">&#xa0; </span><span>// Dispatchers.Main</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>show(result)</span><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>// Dispatchers.Main</span><br /><span>}</span><br /><br /><span>suspend fun get(url: String) =</span><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>// Dispatchers.Main</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>withContext(Dispatchers.IO) {</span><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>// Dispatchers.IO (main-safety block)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>/* 处理网络IO流程</span><span style="-aw-import:spaces">&#xa0; </span><span>*/</span><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>// Dispatchers.IO (main-safety block)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>// Dispatchers.Main</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>//方法二</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>launch(Dispatchers.Default){</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>//</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span>}</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>动图说明</span><br /><img src="https://github.com/jinbo007/Course/blob/master/kotlin/img/%E5%AE%98%E7%BD%91%E5%8A%A8%E5%9B%BE_fetchDocs().gif?raw=true" width="288" height="288" alt="示例图片" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /><span style="-aw-import:ignore">&#xa0;</span></p><h4><span style="font-weight:normal">2.2.3 CoroutineName (协程名称)</span></h4><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>协程的名称，可用于调试时识别当前协程信息</span></p><h4><span style="font-weight:normal">2.2.4 CoroutineExceptionHandler （协程异常捕获器）</span></h4><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>处理未捕获的异常。</span></p><h4><span style="font-weight:normal">问题Q1. CoroutineScope 和 CoroutineContext 区别</span></h4><p><span>参考代码：</span></p><p class="FencedCode"><span>public interface CoroutineScope {</span><br /><span style="-aw-import:spaces">&#xa0; </span><span>public val coroutineContext: CoroutineContext</span><br /><span>}</span></p><p><a href="https://blog.yujinyan.me/posts/kotlin-coroutine-context-scope/" style="text-decoration:none"><span class="Hyperlink">谈谈 Kotlin 协程的 Context 和 Scope</span></a></p><h2><span style="font-weight:normal; font-style:normal">3.</span><span style="font-family:Calibri; font-weight:normal; font-style:normal">常用操作</span></h2><h3><span style="font-weight:normal">3.1 </span><span style="font-family:Calibri; font-weight:normal">开启作用域</span></h3><h4><span style="font-weight:normal">3.1.1 GlobalScope</span></h4><p><span style="font-weight:bold">全局作用域</span><span>，这意味着通过 GlobalScope 启动的协程的生命周期只受整个应用程序的生命周期的限制，只要整个应用程序还在运行且协程的任务还未结束，协程就可以一直运行</span><br /><span>GlobalScope </span><span style="font-weight:bold">不会阻塞其所在线程</span><span>，所以以下代码中主线程的日志会早于 GlobalScope 内部输出日志。</span></p><p><span>调用示例:</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>//直接使用</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>GlobalScope.launch {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(400)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>log("GlobalScope")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>//指定线程</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>GlobalScope.launch(Dispatchers.Default) {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(400)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>log("GlobalScope")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>//指定线程 和 异常捕获器</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>//自定义异常捕获</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val exceptionHandler = CoroutineExceptionHandler { _, e -&gt;</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>println("捕捉到一异常$e")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>GlobalScope.launch(Dispatchers.IO + exceptionHandler) {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(400)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>log("GlobalScope")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:ignore">&#xa0;</span></p><h4><span style="font-weight:normal">3.1.2 runBlocking</span></h4><p class="IndentedCode"><span>可以使用 runBlocking 这个顶层函数来启动协程，常用于测试场景</span></p><p><span>调用示例:</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>fun main()= runBlocking {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>launch {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(500)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>log("runBlocking")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>log("runBlocking finish")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><h4><span style="font-weight:normal">3.1.3 coroutineScope（独立作用域）</span></h4><p class="IndentedCode"><span>coroutineScope 函数用于创建一个独立的协程作用域，直到所有启动的协程都完成后才结束自身</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>runBlocking {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>launch {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(100)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>log("Task from runBlocking")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>coroutineScope {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>log("Task from coroutine scope")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>launch {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(500)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>log("Task from nested launch")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>log("Coroutine scope is over")</span></p><p class="IndentedCode"><span>输出结果</span></p><p class="FencedCode"><span>Task from coroutine scope</span><br /><span>Task from runBlocking</span><br /><span>Task from nested launch</span><br /><span>Coroutine scope is over</span><br /><span style="-aw-import:ignore">&#xa0;</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>独立作用域示意图</span></p><p><img src="https://github.com/jinbo007/Course/blob/master/kotlin/img/%E7%BB%93%E6%9E%84%E5%8C%96%E5%B9%B6%E5%8F%91-coroutineScope.gif?raw=true" width="288" height="288" alt="示意图" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h4><span style="font-weight:normal">3.1.4 supervisorScope（监督作用域）</span></h4><p class="IndentedCode"><span>supervisorScope 函数用于创建一个使用了 SupervisorJob 的 coroutineScope，该作用域的特点就是抛出的异常不会连锁取消同级协程和父协程</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>runBlocking {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>supervisorScope {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>launch {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>/*</span><span style="-aw-import:spaces">&#xa0; </span><span>job */</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><h4><span style="font-weight:normal">3.1.5 自定义CoroutineScope</span></h4><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val handler = CoroutineExceptionHandler { _, e -&gt;</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>println("捕捉到一就异常$e")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>CoroutineScope(Job() + Dispatchers.Main + CoroutineName("hello") + handler)</span></p><h3><span style="font-weight:normal">3.2 </span><span style="font-family:Calibri; font-weight:normal">开启协程</span></h3><h4><span style="font-weight:normal">3.2.1 launch</span></h4><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>不阻塞当前线程</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>返回Job对象</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>执行结果无返回</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>coroutineScope {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>launch {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>repeat(3) {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(100)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>log("launchA - $it")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>launch {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>repeat(3) {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(100)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>log("launchB - $it")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="IndentedCode"><span>执行结果</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>[main] launchA - 0</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>[main] launchB - 0</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>[main] launchA - 1</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>[main] launchB - 1</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>[main] launchA - 2</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>[main] launchB - 2</span></p><h4><span style="font-weight:normal">3.2.2 async</span></h4><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>不阻塞当前线程</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;&#xa0; </span><span>coroutineScope {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val startTime = System.currentTimeMillis()</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val asyncA = async {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(3000)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>1</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val asyncB = async {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(3000)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>2</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>//打印结果: 结果是3,耗时3020</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>println("结果是${asyncA.await() + asyncB.await()},耗时${System.currentTimeMillis()-startTime}")</span><br /><br /><span style="-aw-import:spaces">&#xa0;&#xa0; </span><span>}</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>说明：即使不调用 await(),coroutineScope也会等待子协程运行完成之后，才返回</span><br /><span>参考代码：</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val startTime = System.currentTimeMillis()</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>coroutineScope {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val asyncA = async {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(3000)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>1</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val asyncB = async {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(3000)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>2</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val listOf = listOf(asyncA, asyncB)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>listOf.awaitAll()</span><br /><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>//打印结果：耗时3092</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>println("耗时${System.currentTimeMillis()-startTime}")</span></p><p><span>Tips：</span><br /><span>对于在作用域内创建的新协程，系统会为新协程分配一个新的 Job 实例，而从包含作用域继承其他 CoroutineContext 元素。可以通过向 launch 或 async 函数传递新的 CoroutineContext 替换继承的元素。请注意，将 Job 传递给 launch 或 async 不会产生任何效果，因为系统始终会向新协程分配 Job 的新实例。</span><br /><span>示例代码是这样的</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val subJob = Job()//准备创建的Job</span><br /><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val job1 = scope.launch {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val job2 = scope.launch(subJob + Dispatchers.Default) {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>//此处的subJob指定是无效的，会被创建一个新的</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p><img src="https://github.com/jinbo007/Course/blob/master/kotlin/img/父子协程不同的Job.png?raw=true" width="288" height="288" alt="示意图" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h3><span style="font-weight:normal">3.3</span><span style="font-family:Calibri; font-weight:normal">协程操作</span></h3><h4><span style="font-weight:normal">3.3.1 join()</span></h4><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>等待协程结束</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;&#xa0; </span><span>coroutineScope {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val job = launch {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(100)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>println("子协程执行完成")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>job.join()</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>println("全部任务完成")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>//打印结果</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>子协程执行完成</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>全部任务完成</span></p><h4><span style="font-weight:normal">3.3.2 cancel()</span></h4><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>取消协程</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;&#xa0; </span><span>coroutineScope {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val job = launch {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(100)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>println("子协程执行完成")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>job.cancel()</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>println("全部任务完成")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0; </span><span>//打印结果</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0; </span><span>全部任务完成</span></p><h4><span style="font-weight:normal">3.3.3 cancelAndJoin()</span></h4><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>取消协程并等待</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>coroutineScope {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val job = launch {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>println("打印1.子协程执行完成")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>Thread.sleep(200)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>//delay(200)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>println("打印2.我可以被打出来，是因为会等待")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(100)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>job.cancelAndJoin()</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>println("打印3.全部任务完成")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><h4><span style="font-weight:normal">3.3.3.4 await()</span></h4><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>可以返回async执行的结果</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>val job = async {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(500)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>222</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>var value = job.await()</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>//打印结果是:结果是222</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>println("结果是$value")</span><br /><span style="-aw-import:ignore">&#xa0;</span></p><h4><span style="font-weight:normal">3.3.3.5 awaitAll()</span></h4><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>等待全部结果都返回</span></p><p class="FencedCode"><span style="-aw-import:spaces">&#xa0; </span><span>val time = measureTimeMillis {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val job = async {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(1000)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>222</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val job2 = async {</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delay(2000)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>333</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>println("计算结果:${job.await() + job2.await()}")</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>val jobs = listOf(job, job2)</span><br /><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>jobs.awaitAll()</span><br /><br /><br /><span style="-aw-import:spaces">&#xa0; </span><span>}</span><br /><br /><span style="-aw-import:spaces">&#xa0; </span><span>println("总耗时: $time")</span><br /><br /><span style="-aw-import:spaces">&#xa0; </span><span>//打印结果：</span><br /><span style="-aw-import:spaces">&#xa0; </span><span>计算结果:555</span><br /><span style="-aw-import:spaces">&#xa0; </span><span>总耗时: 2030</span><br /><span style="-aw-import:ignore">&#xa0;</span></p><h2><span style="font-weight:normal; font-style:normal">4.</span><span style="font-family:Calibri; font-weight:normal; font-style:normal">异常处理</span></h2><h3><span style="font-weight:normal">4.1 </span><span style="font-family:Calibri; font-weight:normal">异常传播机制</span></h3><h4><span style="font-weight:normal">4.1.1 独立作用域的传播机制（协同作用域）</span></h4><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>取消它自己的子级</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>取消它自己</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>将异常传播并传递给它的父级</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>不能独立处理异常</span></p><p><span>[独立作用域传播特性]</span><br /><img src="https://github.com/jinbo007/Course/blob/master/kotlin/img/coroutineScope异常传播.gif?raw=true" width="288" height="288" alt="示意图片" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /><span style="-aw-import:ignore">&#xa0;</span></p><h4><span style="font-weight:normal">4.2.2监督作用域的传播机制（主从作用域）</span></h4><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>取消自己和子级</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>可以独立处理异常</span></p><h5><span style="font-weight:normal; font-style:normal">监督作用域传播特性</span></h5><p><img src="https://github.com/jinbo007/Course/blob/master/kotlin/img/SuperVisor异常传播机制.png?raw=true" width="288" height="288" alt="示意图" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h5><span style="font-weight:normal; font-style:normal">来个例子</span></h5><p><img src="https://github.com/jinbo007/Course/blob/master/kotlin/img/%E5%8D%8F%E7%A8%8B%E5%BC%82%E5%B8%B8%E4%BC%A0%E6%92%AD%E5%88%86%E6%9E%90.png?raw=true" width="288" height="288" alt="图片1" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p><span>路线图：</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>C2-1发生异常的时候，C2-1-&gt;C2-&gt;C2-2-&gt;C2-&gt;C1-&gt;C3（包括里面的子协程）-&gt;C4</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>C3-1-1发生异常的时候,C3-1-1-&gt;C3-1-1-1，其他不受影响</span><br /><a href="https://juejin.cn/post/6935472332735512606#heading-18" style="text-decoration:none"><span class="Hyperlink">本部分参考来源-协程异常机制与优雅封装</span></a></p><h3><span style="font-weight:normal">4.2 </span><span style="font-family:Calibri; font-weight:normal">细节</span></h3><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>取消异常会被忽略(不会取消它的父协程)- Cancellation</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>父协程会等待子协程处理完成之后才开始处理异常</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>异常聚合 如果有多个异常，将会处理第一个异常信息（其他异常信息附加后边）</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>异常可以在try-catch包装执行后再上送</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>监督任务，内部子协程之间的异常不会相互传递，即平级协程不影响</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>监督子协程可以自行处理自己的异常信息</span></p><p><a href="https://www.kotlincn.net/docs/reference/coroutines/exception-handling.html" style="text-decoration:none"><span class="Hyperlink">详细参考-Kotlin官网-异常处理与监督</span></a></p><h2><span style="font-weight:normal; font-style:normal">5.</span><span style="font-family:Calibri; font-weight:normal; font-style:normal">扩展</span></h2><p><span>jetpack扩展</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>viewModelScope(android-ktx)</span></p><p style="margin-left:36pt; text-indent:-18pt; -aw-import:list-item; -aw-list-level-number:0; -aw-list-number-format:'-'; -aw-list-number-styles:'bullet'; -aw-list-padding-sml:11.4pt"><span style="-aw-import:ignore"><span><span style="font-family:'Courier New'">-</span></span><span style="width:11.4pt; font:7pt 'Times New Roman'; display:inline-block; -aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span></span><span>lifecycleScope(android-ktx)</span></p><p><span>协程就是Callback?</span><br /><a href="https://juejin.cn/post/6883652600462327821#heading-13" style="text-decoration:none"><span class="Hyperlink">CPS转换</span></a></p><h2><span style="font-weight:normal; font-style:normal">6.</span><span style="font-family:Calibri; font-weight:normal; font-style:normal">系列课程，下次一定？</span></h2><h4><span>Kotlin系列二之Kotlin协程在Android上的应用</span></h4><h4><span>Kotlin系列三之Kotin之Chanel、Flow</span></h4><h4><span style="font-weight:normal">官网资料</span></h4><p><a href="https://developer.android.com/kotlin/coroutines" style="text-decoration:none"><span class="Hyperlink" style="-aw-import:spaces">&#xa0;</span><span class="Hyperlink">Kotlin 协程</span></a><br /><a href="https://play.kotlinlang.org/hands-on/Introduction%20to%20Coroutines%20and%20Channels/01_Introduction" style="text-decoration:none"><span class="Hyperlink">协程概览</span></a><br /><a href="https://developer.android.com/kotlin/coroutines/additional-resources" style="text-decoration:none"><span class="Hyperlink">协程官网推荐的学习资料</span></a></p><h4><span style="font-weight:normal">协程上的取消和异常机制(Cancellation and Exceptions in Coroutines-Manuel Vivo)</span></h4><p><a href="https://medium.com/androiddevelopers/coroutines-first-things-first-e6187bf3bb21" style="text-decoration:none"><span class="Hyperlink">前提内容 First things first(Part 1)</span></a><br /><a href="https://medium.com/androiddevelopers/cancellation-in-coroutines-aa6b90163629" style="text-decoration:none"><span class="Hyperlink">协程的取消机制 Cancellation in coroutines (Part 2)</span></a><br /><a href="https://medium.com/androiddevelopers/exceptions-in-coroutines-ce8da1ec060c" style="text-decoration:none"><span class="Hyperlink">协程中的异常处理 Exceptions in coroutines-part3</span></a><br /><a href="https://medium.com/androiddevelopers/coroutines-patterns-for-work-that-shouldnt-be-cancelled-e26c40f142ad" style="text-decoration:none"><span class="Hyperlink">协程不应该取消的设计模式 Coroutines &amp; Patterns for work that shouldn’t be cancelled-Part 4</span></a></p><h4><span style="font-weight:normal">协程在Android上的应用-Sean McQuillan</span></h4><p><a href="https://medium.com/androiddevelopers/coroutines-on-android-part-i-getting-the-background-3e0e54d20bb" style="text-decoration:none"><span class="Hyperlink">Coroutines on Android (part I): Getting the background</span></a><br /><a href="https://medium.com/androiddevelopers/coroutines-on-android-part-ii-getting-started-3bff117176dd" style="text-decoration:none"><span class="Hyperlink">Coroutines on Android (part II): getting started</span></a><br /><a href="https://medium.com/androiddevelopers/coroutines-on-android-part-iii-real-work-2ba8a2ec2f45b" style="text-decoration:none"><span class="Hyperlink">Coroutines On Android (part III): real work </span></a></p><h4><span style="font-weight:normal">RicardoMJiang系列博客</span></h4><p><a href="https://juejin.cn/post/6934337634831433736" style="text-decoration:none"><span class="Hyperlink">关于协程你应该知道的知识点</span></a><br /><a href="https://juejin.cn/post/6973650934664527885" style="text-decoration:none"><span class="Hyperlink">协程到底是什么?</span></a><br /><a href="https://juejin.cn/post/6981056016897015838" style="text-decoration:none"><span class="Hyperlink">协程到底是怎么切换线程的</span></a><br /><a href="https://juejin.cn/post/6935472332735512606" style="text-decoration:none"><span class="Hyperlink">协程异常机制与优雅封装</span></a><br /><a href="https://juejin.cn/post/6988876911338323981" style="text-decoration:none"><span class="Hyperlink">协程异常到底是怎么传播的?</span></a></p><h4><span style="font-weight:normal">朱涛的自习室</span></h4><p><a href="https://juejin.cn/post/6883652600462327821" style="text-decoration:none"><span class="Hyperlink">Kotlin Jetpack 实战 | 09. 图解协程原理</span></a></p><h4><span style="font-weight:normal">其他</span></h4><p><a href="https://juejin.cn/post/6908271959381901325#heading-32" style="text-decoration:none"><span class="Hyperlink">一文快速入门 Kotlin 协程</span></a><br /><a href="https://juejin.cn/post/6987724340775108622#heading-25" style="text-decoration:none"><span class="Hyperlink">一文看透 Kotlin 协程本质</span></a></p></div></body></html>